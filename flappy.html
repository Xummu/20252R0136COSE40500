<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird 简约版</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #70c5ce; overflow: hidden; font-family: sans-serif; }
        canvas { border: 2px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); background: #70c5ce; }
    </style>
</head>
<body>
    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    canvas.width = 320;
    canvas.height = 480;

    // 游戏变量
    let score = 0;
    let isGameOver = false;

    // 小鸟属性
    const bird = {
        x: 50,
        y: 150,
        w: 30,
        h: 24,
        gravity: 0.25,
        velocity: 0,
        jump: -4.5
    };

    // 水管属性
    let pipes = [];
    const pipeWidth = 50;
    const pipeGap = 120; // 上下水管之间的间隙
    let frameCount = 0;

    function createPipe() {
        const minHeight = 50;
        const maxHeight = canvas.height - pipeGap - minHeight;
        const height = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
        
        pipes.push({
            x: canvas.width,
            topHeight: height,
            passed: false
        });
    }

    function update() {
        if (isGameOver) return;

        // 1. 小鸟物理逻辑
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;

        // 碰撞天花板或地板
        if (bird.y + bird.h > canvas.height || bird.y < 0) {
            gameOver();
        }

        // 2. 水管逻辑
        if (frameCount % 90 === 0) createPipe();
        frameCount++;

        for (let i = pipes.length - 1; i >= 0; i--) {
            let p = pipes[i];
            p.x -= 2;

            // 碰撞检测
            // 检测上方水管
            if (bird.x + bird.w > p.x && bird.x < p.x + pipeWidth && bird.y < p.topHeight) {
                gameOver();
            }
            // 检测下方水管
            if (bird.x + bird.w > p.x && bird.x < p.x + pipeWidth && bird.y + bird.h > p.topHeight + pipeGap) {
                gameOver();
            }

            // 计分
            if (!p.passed && bird.x > p.x + pipeWidth) {
                score++;
                p.passed = true;
            }

            // 移除出屏水管
            if (p.x + pipeWidth < 0) pipes.splice(i, 1);
        }
    }

    function draw() {
        // 清空背景
        ctx.fillStyle = "#70c5ce";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 绘制水管
        pipes.forEach(p => {
            ctx.fillStyle = "#73bf2e";
            // 上半部分
            ctx.fillRect(p.x, 0, pipeWidth, p.topHeight);
            ctx.strokeRect(p.x, 0, pipeWidth, p.topHeight);
            // 下半部分
            ctx.fillRect(p.x, p.topHeight + pipeGap, pipeWidth, canvas.height);
            ctx.strokeRect(p.x, p.topHeight + pipeGap, pipeWidth, canvas.height);
        });

        // 绘制小鸟
        ctx.fillStyle = "#f7e02a";
        ctx.fillRect(bird.x, bird.y, bird.w, bird.h);
        ctx.strokeStyle = "#000";
        ctx.strokeRect(bird.x, bird.y, bird.w, bird.h);

        // 绘制分数
        ctx.fillStyle = "#fff";
        ctx.font = "30px Arial";
        ctx.textAlign = "center";
        ctx.fillText(score, canvas.width / 2, 50);

        if (!isGameOver) {
            update();
            requestAnimationFrame(draw);
        }
    }

    function gameOver() {
        isGameOver = true;
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.fillText("游戏结束", canvas.width / 2, canvas.height / 2);
        ctx.font = "20px Arial";
        ctx.fillText("点击重新开始", canvas.width / 2, canvas.height / 2 + 40);
    }

    // 交互
    function flap() {
        if (isGameOver) {
            // 重置游戏
            bird.y = 150;
            bird.velocity = 0;
            pipes = [];
            score = 0;
            frameCount = 0;
            isGameOver = false;
            draw();
        } else {
            bird.velocity = bird.jump;
        }
    }

    window.addEventListener('keydown', e => { if(e.code === 'Space') flap(); });
    canvas.addEventListener('mousedown', flap);

    draw();
</script>
</body>
</html>